<form [formGroup]="messageForm" (ngSubmit)="sendMessage()">
  <ng-container *ngIf="!recording else recordingTemplate">
    <span class="length-indicator" [class.limit-reached]="messageForm.value.text.length > maxLength">{{messageForm.value.text.length}}/{{maxLength}}</span>
    <div class="input-wrapper">
      <tui-input formControlName="text" tuiTextfieldSize="s">
        Type a message...
        <input tuiTextfield autocomplete="off" (keydown)="onKeyDown($event)"/>
      </tui-input>
      <button
        tuiIconButton
        type="button"
        size="s"
        icon="tuiIconMicLarge"
        (click)="startRecording()"
        ></button>
    </div>
  </ng-container>
</form>

<ng-template #recordingTemplate>
  <div class="recording-wrapper">
    <div class="timer">
      <div class="record-dot"></div>
      <span class="record-time">{{(currentTime$ | async) || 0 | timer}}</span>
    </div>
    <div class="recording-controls">
      <button tuiIconButton type="button" size="s" appearance="icon" icon="tuiIconTrashLarge" (click)="cancelRecording()"></button>
      <button tuiIconButton type="button" size="s" appearance="icon" icon="tuiIconPauseLarge" (click)="pauseRecording()"></button>
      <button tuiIconButton type="button" size="s" [icon]="sendIcon" (click)="sendRecording()"></button>
    </div>
  </div>
</ng-template>

<ng-template #sendIcon>
  <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="-40 -40 200 200" width="32" height="32"><path d="m2.33 44.58 115-44.21a3.63 3.63 0 0 1 5 4.56l-44 115.61a3.63 3.63 0 0 1-6.67.28L53.93 84.14l35.19-50.37-50.27 35.09L2.06 51.24a3.63 3.63 0 0 1 .27-6.66Z" style="fill:currentColor"/></svg>
</ng-template>
